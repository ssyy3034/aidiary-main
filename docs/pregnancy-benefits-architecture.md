# 임신·출산 지원금 및 혜택 기능 아키텍처 가이드 (Pregnancy Benefits Architecture)

## 1. 개요 (Overview)

본 문서는 AIDIARY 앱 내 산모 대상 **초보 부모를 위한 필수 행정 및 지원금 혜택 안내 기능**의 설계 및 진화 전략을 정의합니다. 공공데이터포털(data.go.kr) 등 외부 API의 불안정성과 파편화 문제를 우려하여, 점진적인 진화 아키텍처(Evolutionary Architecture) 패턴을 채택합니다.

## 2. Phase 1: 정적 코어 데이터 모델 (Static Core Data) - 현재 채택

가장 빠르고 높은 임팩트를 내기 위해 코어가 되는 '전국 공통 표준 혜택'을 시스템 내부에 정의(Hardcoded or DB Seed)하여 전역으로 관리합니다.

### 2.1. 데이터 스펙

- 대상: 국민행복카드(진료비 바우처), 보건소 철분제/엽산 제공, 첫만남이용권, 부모급여 등 전국 공통 사항 (약 5~10종류 이내)
- 형식: 프론트엔드 전역 상태(Context/Store) 혹은 상수 파일(`constants/benefits.ts`), 또는 백엔드 초기 Seed DB로 관리.
- 주차별 매핑: 각 혜택 객체 내부에 `recommendedWeek` (권장 임신 주차) 필드를 두어 유저의 현재 주차에 맞춰 UI에 노출.

### 2.2. 프로세스 플로우

1. 앱이 빌드될 때 고정된 혜택 리스트가 클라이언트/서버에 로드됨.
2. 유저의 출산 예정일 기반으로 현재 `week` 계산.
3. 해당 `week`에 가장 적합한 혜택(꿀팁) 알림 UI 노출.

### 2.3. 업데이트 정책 (Manual Update)

- 주체: 개발자 또는 서비스 운영자
- 주기: 연 1~2회 (보통 정부 정책은 연초에 변경됨)
- 방법: 정책 변경(예: 지원금 액수 인상) 시 코드베이스 상수값 변경 후 핫픽스/정기 배포로 업데이트 처리.

---

## 3. Phase 2: DB 기반 동적 콘텐츠 제공 (Dynamic Database) - 과도기

UI와 데이터를 분리하기 위해 혜택 정보를 백엔드 DB(예: `Benefit` Entity)로 완전히 이관합니다.

- **장점**: 개발자의 재배포(App Update) 없이 어드민(Admin) 페이지나 백엔드 스크립트를 통해 언제든 혜택 금액이나 내용을 수정할 수 있습니다.
- 백엔드에 `/api/benefits` 엔드포인트를 열어 프론트엔드가 진입 시 데이터를 Fetch하게 됩니다.

---

## 4. Phase 3: 외부 API 자동 동기화 (Automated API Integration) - 미래 확장판 (Future Plan)

지자체별 복잡한 세부 혜택까지 완벽히 커버하고, 수동 업데이트의 짐을 덜기 위해 외부 공공 API를 연결하는 심화 과정입니다. 본 프로젝트의 스코프에서는 **선택적 확장 기능(예정)**으로 남겨둡니다.

### 4.1. 아키텍처: 배치 기반 데이터 동기화 (Batch Synchronization)

사용자 요청(Client Request) 시마다 공공 API를 실시간 호출(Sync Fetch)하는 방식은 **절대 지양**합니다 (공공 서버 에러가 우리 앱 에러로 직결됨).
대신 다음의 **비동기 배치(Batch) 아키텍처**를 구상합니다.

1. **Spring Batch / Scheduler**: AIDIARY 백엔드는 매일 새벽(예: AM 03:00) 공공데이터포털의 API(`data.go.kr`)를 호출.
2. **Data Cleansing**: XML/JSON 파편화된 외부 데이터를 우리의 `Benefit` 구조에 맞게 파싱 및 정제.
3. **DB Update**: 변경된 정책(지원금 인상 등)이 감지되면 내부 DB를 덮어쓰거나(Update) 신규 등록.
4. **Client API**: 프론트엔드는 오직 AIDIARY 백엔드 로컬 DB에 저장된 `/api/benefits`만 조회. 외부 서버 장애와 무관하게 24시간 빠르고 안정적인 서비스 제공 가능.

### 4.2. 필수 요구사항

- 유저 프로필 확장: 지자체별 세부 혜택을 구분하기 위해 유저 정보에 '거주지(시/도, 시/군/구)' 데이터가 필요.

---

## 5. 결론 및 진행 방향 (Next Step)

사용자의 요청에 따라 본 기능은 **Phase 2 (DB 기반 동적 콘텐츠 제공)까지만 1차적으로 구현**합니다.

1. 프론트엔드 체크리스트 UI 구현 및 정적 데이터 렌더링.
2. 백엔드 `Benefit` Entity 생성 및 어드민(수동) 관리를 위한 API 및 DB 구축.
3. 공공데이터를 주기적으로 동기화하는 Phase 3는 향후 고도화 목표로 예정해 둡니다.
